# Set Reputation of a Malicious File (Retrospective)
Date 2/21/2018

OpenC2 Working Draft 03

## Objective
This use case was created in order to explore a retrospective view, in accordance with the current version of the OpenC2 language specification, of the use case described in [01.set_reputation.md](https://github.com/oasis-tcs/openc2-lsc-usecases/blob/master/G2/01.set_reputation.md). The plan is to continue to do these retrospectives throughout the OpenC2 language development lifecycle to gain understanding and help shape the future of the OpenC2.

## Format
We will present the complete OpenC2 message. Then we will go through each block and explain our reasoning. Finally we will show some modified examples.

## OpenC2 Complete Messsage
```json
{
	"action": "set",	
	"target":{ 
		"target-name": "artifact", 
		"target-specifiers":{
		  "type": "reputation"
		},
		"target-options":{},
		"reputation": { 
			"type": "file",
			"name": "evil.exe",
			"severity": 7,
			"comment": "Reputation assessed by STIX, set via OpenC2",
			"hashes":[
				{
				"value": "098F6BCD4621D373CADE4E832627B4F6",
				"type": "md5"
				},
				{
				"value": "A94A8FE5CCB19BA61C4C0873D391E987982FBBD3",
				"type": "sha1"
				}
			]
		}
	},
	"actuator":{ 
		"actuator-name": "Threat Intelligence",
		"actuator-specifiers":{
		  "type": "hostname"
		},
		"actuator-options":{
		  "ap_version": "1.1"
		},
		"hostname": "McAfee_TIE_01"
	},
	"command-options":{
		"command_id": "ABCDEF123456789",
		"start_time": 1519247125,
		"periodicity": "once",
		"duration": "permanent",
		"openc2_version": "1.6"
	}
}
```
## OpenC2 action block
Not much has changed here, we decided to stay with the action verb "set" because we felt that as of the current version of the OpenC2 language it still filled our requirements.
```json
	"action": "set",
```
## OpenC2 target block
Here is where things start to diverge. Not only did we move away from "file" as our target but we also modified the structure of our definition in accordance with our reading of the current version of the OpenC2 language. The decision to move away from "file" as a target was a contested one but we felt that it was the right one. The main reason for this change was to not pollute file target properties. Additionally, we felt that the action of setting a reputation was not being performed directly on a file but rather referenced a potentially non-existent file on a potentially non-existent system.

### target-name and target-specifiers
Although discussed in the current version of the OpenC2 language specification, no current use case utilizes these constructs. We decided to utilize them in our use case because we felt that it organized the data well. Additionally, it allowed us to be more specific with our target. We chose "artifact" because we felt it was the only target flexible enough to be further specified into "reputation". However, we believe the language would be better served if we added a new target construct such as "object", "data", or "other". Additionally, we believe that "reputation" and all its property tables should be further defined within the actuator profile that utilizes it as a target-specifier.
```json	
	"target":{ 
		"target-name": "artifact",
		"target-specifiers":{
		  "type": "reputation"
		},
```
I can also see a case for utilizing the above-mentioned strategy to define targets from other specifications, aka "namespaces". The following could be an example of this. With the main difference here being that the actuator profile would not need to define all the property tables related to the target-specifier, but rather simply state that target-specifier X is modeled from specification Y.
```json	
		"target-options":{},
```
Nothing to report here.
```json	
		"reputation": { 
			"type": "file",
			"name": "evil.exe",
			"severity": 7, //defined at the AP level
			"comment": "Reputation assessed by STIX, set via OpenC2",
			"hashes":[
				{
				"value": "098F6BCD4621D373CADE4E832627B4F6",
				"type": "md5"
				},
				{
				"value": "A94A8FE5CCB19BA61C4C0873D391E987982FBBD3",
				"type": "sha1"
				}
			]
		}
	},
//END OF TARGET SECTION
```
## OpenC2 Commands
```json
{
	"action": "set",
	
//START OF TARGET SECTION	
	"target":{ 
		"target-name": "artifact", //or something new like object, data, or other
		"target-specifiers":{
		  "type": "reputation" //defined at the AP level
		},
		"target-options":{
		  //nothing here for now
		},
		"reputation": { //defined at the AP level
			"type": "file",
			"name": "evil.exe",
			"severity": 7, //defined at the AP level
			"comment": "Reputation assessed by STIX, set via OpenC2",
			"hashes":[
				{
				"value": "098F6BCD4621D373CADE4E832627B4F6",
				"type": "md5"
				},
				{
				"value": "A94A8FE5CCB19BA61C4C0873D391E987982FBBD3",
				"type": "sha1"
				}
			]
		}
	},
//END OF TARGET SECTION

//START OF ACTUATOR SECTION
	"actuator":{ 
		"actuator-name": "Threat Intelligence", //the AP name
		"actuator-specifiers":{
		  "type": "hostname"
		},
		"actuator-options":{
		  "ap_version": "1.1"
		},
		"hostname": "McAfee_TIE_01"
	},
//END OF ACTUATOR SECTION	

//START OF COMMAND OPTIONS
	"command-options":{
		"command_id": "ABCDEF123456789",
		"start_time": 1519247125,
		"periodicity": "once",
		"duration": "permanent",
		"openc2_version": "1.6"
	}
//END OF COMMAND OPTIONS	
}
```
Here we utilized the “SET” action to set the reputation of a file to “Known Malicious”. Once this is done all host-based clients commanded by McAfee EPO should execute the preconfigured network security policy.    

## Definition of Done
The malicious file is handled properly according to network security policy. In our case stopped, denied, and quarantined. 

## Endnotes
We did not specify an actuator in the OpenC2 command because at the time we only had one actuator to work with. In hindsight it may have been better to specify an actuator. It is likely that a device like McAfee EPO will have multiple actuator profiles and it is not entirely clear what is being “SET” in this command.
